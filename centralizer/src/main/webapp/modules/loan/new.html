<div class="page-container">
    <div class="page-header">
        <h2>New Loan</h2>
    </div>
    <form id="new-loan-form">
        <div class="form-group">
            <label for="customer-id">Customer *</label>
            <select id="customer-id" name="customerId" required>
                <option value="">Select a customer</option>
            </select>
        </div>
        <div class="form-group">
            <label for="amount">Loan Amount *</label>
            <input type="number" id="amount" name="amount" step="0.01" min="1" required>
        </div>
        <div class="form-group">
            <label for="interest-rate">Interest Rate (%) *</label>
            <input type="number" id="interest-rate" name="interestRate" step="0.01" value="5.00" required>
        </div>
        <div class="form-group">
            <label for="duration">Duration (months) *</label>
            <input type="number" id="duration" name="duration" min="1" value="12" required>
        </div>
        <div class="form-group">
            <label for="purpose">Loan Purpose</label>
            <select id="purpose" name="purpose">
                <option value="PERSONAL">Personal</option>
                <option value="HOME">Home</option>
                <option value="CAR">Car</option>
                <option value="BUSINESS">Business</option>
                <option value="OTHER">Other</option>
            </select>
        </div>
        <div style="margin-top: 24px;">
            <button type="submit" class="btn btn-primary">Create Loan</button>
            <button type="reset" class="btn btn-secondary" style="margin-left: 8px;">Reset</button>
        </div>
    </form>
</div>

<script>
// Load customers for dropdown
fetch('/customer/api/customers')
    .then(response => response.json())
    .then(customers => {
        const select = document.getElementById('customer-id');
        customers.forEach(customer => {
            const option = document.createElement('option');
            option.value = customer.id;
            option.textContent = `${customer.name} (${customer.email})`;
            select.appendChild(option);
        });
    });

document.getElementById('new-loan-form').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = {
        customerId: document.getElementById('customer-id').value,
        amount: parseFloat(document.getElementById('amount').value),
        interestRate: parseFloat(document.getElementById('interest-rate').value),
        duration: parseInt(document.getElementById('duration').value),
        purpose: document.getElementById('purpose').value
    };

    fetch('/loan/api/loans', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        showMessage('Loan created successfully!');
        this.reset();
    })
    .catch(error => {
        showMessage('Failed to create loan', 'error');
    });
});
</script>

