<div class="page-container">
    <div class="page-header">
        <h2>New Deposit Account</h2>
    </div>

    <div id="message-container"></div>

    <form id="new-deposit-form" onsubmit="return submitForm(event)">
        <div class="form-group">
            <label for="customer-id">Customer ID *</label>
            <input type="number" id="customer-id" name="customerId" required 
                   placeholder="Enter customer ID" min="1">
            <small style="color: #666;">Enter the ID of an existing customer</small>
        </div>

        <div class="form-group">
            <label for="account-number">Account Number *</label>
            <input type="text" id="account-number" name="accountNumber" required 
                   placeholder="DEP-2024-001">
            <small style="color: #666;">Format: DEP-YYYY-XXX</small>
        </div>

        <div class="form-group">
            <label for="initial-balance">Initial Balance</label>
            <input type="number" id="initial-balance" name="initialBalance" 
                   step="0.01" min="0" value="0.00">
        </div>

        <div class="form-group">
            <label for="annual-rate">Annual Interest Rate (%) *</label>
            <input type="number" id="annual-rate" name="annualRate" 
                   step="0.01" min="0" max="100" value="2.50" required>
            <small style="color: #666;">Typical range: 1% - 5%</small>
        </div>

        <div class="form-group">
            <label for="withdrawal-limit">Monthly Withdrawal Limit *</label>
            <input type="number" id="withdrawal-limit" name="monthlyWithdrawalLimit" 
                   min="0" value="3" required>
            <small style="color: #666;">Number of withdrawals allowed per month</small>
        </div>

        <div style="margin-top: 24px;">
            <button type="submit" class="btn btn-primary">Create Account</button>
            <button type="reset" class="btn btn-secondary" style="margin-left: 8px;">Reset</button>
            <button type="button" class="btn btn-secondary" onclick="loadPage('deposit', 'list')" 
                    style="margin-left: 8px;">Cancel</button>
        </div>
    </form>
</div>

<script>
const DEPOSIT_API_URL = 'http://localhost:5000/api/deposit-accounts';

function submitForm(event) {
    event.preventDefault();

    const formData = {
        customerId: parseInt(document.getElementById('customer-id').value),
        accountNumber: document.getElementById('account-number').value,
        balance: parseFloat(document.getElementById('initial-balance').value),
        annualRate: parseFloat(document.getElementById('annual-rate').value),
        monthlyWithdrawalLimit: parseInt(document.getElementById('withdrawal-limit').value),
        withdrawalsThisMonth: 0,
        status: 'ACTIVE'
    };

    fetch(DEPOSIT_API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(text => {
                throw new Error(text || 'Failed to create account');
            });
        }
        return response.json();
    })
    .then(data => {
        showMessage('Deposit account created successfully! Account Number: ' + data.accountNumber, 'success');
        document.getElementById('new-deposit-form').reset();
        setTimeout(() => {
            loadPage('deposit', 'list');
        }, 2000);
    })
    .catch(error => {
        console.error('Error:', error);
        showMessage('Failed to create account: ' + error.message, 'error');
    });

    return false;
}

function showMessage(message, type = 'success') {
    const container = document.getElementById('message-container');
    const className = type === 'success' ? 'success-message' : 'error-message';
    container.innerHTML = `<div class="${className}" style="padding: 10px; margin: 10px 0; border-radius: 4px; 
                            background: ${type === 'success' ? '#d4edda' : '#f8d7da'}; 
                            color: ${type === 'success' ? '#155724' : '#721c24'}; 
                            border: 1px solid ${type === 'success' ? '#c3e6cb' : '#f5c6cb'};">
                            ${message}
                           </div>`;
}
</script>
